<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>首班指名選挙シミュレーション</title>
<style>
  body {
    font-family: sans-serif;
    background-color: #f4f4f4;
    margin: 0;
  }
  h1 {
    text-align: center;
    margin-top: 10px;
  }
  .top-container {
    display: flex;
    justify-content: space-around;
    margin: 10px;
  }
  .bottom-container {
    margin: 10px;
  }
  .candidate {
    min-height: 400px;
    border: 2px dashed #aaa;
    padding: 10px;
    background-color: #fff;
    box-sizing: border-box;
  }
  .candidate h2 {
    text-align: center;
  }
  /* 上段の幅指定 */
  #pool, #candidateA, #candidateB {
    width: 32%;
  }
  /* 下段のその他欄は横幅いっぱい */
  #others {
    width: 100%;
    min-height: 200px;
  }
  .party {
    margin: 5px;
    cursor: grab;
    border-radius: 5px;
    text-align: center;
    font-weight: bold;
    color: #fff;
    display: inline-block;
    white-space: nowrap;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
  }
  .party.dragging {
    opacity: 0.5;
  }
  .result {
    text-align: center;
    font-size: 1.2em;
    margin-top: 10px;
    font-weight: bold;
  }
  .majority-line {
    text-align: center;
    margin-top: 5px;
    font-size: 1em;
    color: #555;
  }
  .name-inputs {
    text-align: center;
    margin: 10px;
  }
  .name-inputs input {
    padding: 5px;
    margin: 5px;
    font-size: 1em;
  }
  .name-inputs button {
    padding: 5px 10px;
    margin: 5px;
    font-size: 1em;
    cursor: pointer;
  }
  .list {
    font-size: 0.9em;
    margin-top: 5px;
    padding: 5px;
    background: #f9f9f9;
    border-radius: 5px;
  }
</style>
</head>
<body>

<h1>衆議院 首班指名選挙 決選投票シミュレーション</h1>

<div class="name-inputs">
  候補A名: <input id="nameA" type="text" value="候補A">
  候補B名: <input id="nameB" type="text" value="候補B">
  <button onclick="updateCounts()">名前更新</button>
  <button onclick="resetSimulation()">リセット</button>
</div>

<div class="top-container">
  <div id="pool" class="candidate">
    <h2>議席プール</h2>
  </div>
  <div id="candidateA" class="candidate">
    <h2>候補A（合計: 0）</h2>
    <div id="listA" class="list"></div>
  </div>
  <div id="candidateB" class="candidate">
    <h2>候補B（合計: 0）</h2>
    <div id="listB" class="list"></div>
  </div>
</div>

<div class="bottom-container">
  <div id="others" class="candidate">
    <h2>その他（合計: 0）</h2>
    <div id="listOthers" class="list"></div>
  </div>
</div>

<div class="majority-line">過半数ライン: 233議席</div>
<div id="result" class="result">勝者判定: 未決定</div>

<script>
const MAJORITY = 233;

// 野党系無所属の13人（林追加＋河村・竹上）
const oppositionMembers = [
  "緒方", "吉良", "北神", "福島", "守島",
  "阿部", "斉木", "松原", "中村", "平岩", "林", "河村", "竹上"
];

const parties = [
  { name: "自民", seats: 196, color: "#DC1E1E" },
  { name: "公明", seats: 24, color: "#FA5ABE" },
  { name: "立憲", seats: 148, color: "#0078DC" },
  { name: "維新", seats: 34, color: "#82BE1E" },
  { name: "共産", seats: 8, color: "#9600BE" },
  { name: "国民", seats: 27, color: "#2D37D7" },
  { name: "れいわ", seats: 9, color: "#DC0082" },
  { name: "社民", seats: 1, color: "#00AAF0" },
  { name: "参政", seats: 3, color: "#F06932" },
  { name: "保守", seats: 1, color: "#646EFF" }, // ★変更
  { name: "世耕", seats: 1, color: "#C80028" },
  ...oppositionMembers.map(name => ({
    name: name,
    seats: 1,
    color: "#003246"
  }))
];

function createPartyElement(party) {
  const div = document.createElement("div");
  div.className = "party";
  div.textContent = `${party.name} (${party.seats})`;
  div.draggable = true;
  div.dataset.seats = party.seats;
  div.dataset.name = party.name;
  div.style.backgroundColor = party.color;
  const barHeight = Math.min(party.seats * 0.5 + 15, 50);
  const barWidth = Math.min(party.seats * 3 + 40, 300);
  div.style.height = `${barHeight}px`;
  div.style.width = `${barWidth}px`;
  div.style.fontSize = `${Math.max(barHeight * 0.6, 12)}px`;
  div.style.lineHeight = `${barHeight}px`;
  return div;
}

function initPool() {
  const pool = document.getElementById("pool");
  pool.innerHTML = "<h2>議席プール</h2>";
  parties.forEach(p => {
    pool.appendChild(createPartyElement(p));
  });
}
initPool();

let draggedEl = null;

document.querySelectorAll(".candidate").forEach(area => {
  area.addEventListener("dragover", e => {
    e.preventDefault();
    const afterElement = getDragAfterElement(area, e.clientY);
    if (afterElement == null) {
      area.appendChild(draggedEl);
    } else {
      area.insertBefore(draggedEl, afterElement);
    }
  });
  area.addEventListener("drop", e => {
    e.preventDefault();
    draggedEl.classList.remove("dragging");
    updateCounts();
  });
});

document.addEventListener("dragstart", e => {
  if (e.target.classList.contains("party")) {
    draggedEl = e.target;
    e.target.classList.add("dragging");
  }
});

document.addEventListener("dragend", e => {
  if (e.target.classList.contains("party")) {
    e.target.classList.remove("dragging");
    draggedEl = null;
    updateCounts();
  }
});

function getDragAfterElement(container, y) {
  const draggableElements = [...container.querySelectorAll(".party:not(.dragging)")];
  return draggableElements.reduce((closest, child) => {
    const box = child.getBoundingClientRect();
    const offset = y - box.top - box.height / 2;
    if (offset < 0 && offset > closest.offset) {
      return { offset: offset, element: child };
    } else {
      return closest;
    }
  }, { offset: Number.NEGATIVE_INFINITY }).element;
}

function updateCounts() {
  const nameA = document.getElementById("nameA").value || "候補A";
  const nameB = document.getElementById("nameB").value || "候補B";
  const partiesA = Array.from(document.getElementById("candidateA").querySelectorAll(".party"));
  const partiesB = Array.from(document.getElementById("candidateB").querySelectorAll(".party"));
  const partiesO = Array.from(document.getElementById("others").querySelectorAll(".party"));
  const partiesPool = Array.from(document.getElementById("pool").querySelectorAll(".party"));
  const seatsA = partiesA.reduce((sum, el) => sum + parseInt(el.dataset.seats), 0);
  const seatsB = partiesB.reduce((sum, el) => sum + parseInt(el.dataset.seats), 0);
  const seatsO = partiesO.reduce((sum, el) => sum + parseInt(el.dataset.seats), 0);
  const seatsPool = partiesPool.reduce((sum, el) => sum + parseInt(el.dataset.seats), 0);
  document.querySelector("#candidateA h2").textContent = `${nameA}（合計: ${seatsA}）`;
  document.querySelector("#candidateB h2").textContent = `${nameB}（合計: ${seatsB}）`;
  document.querySelector("#others h2").textContent = `その他（合計: ${seatsO}）`;
  document.querySelector("#pool h2").textContent = `議席プール（合計: ${seatsPool}）`;
  document.getElementById("listA").textContent = partiesA.map(el => el.dataset.name).join("、") || "なし";
  document.getElementById("listB").textContent = partiesB.map(el => el.dataset.name).join("、") || "なし";
  document.getElementById("listOthers").textContent = partiesO.map(el => el.dataset.name).join("、") || "なし";
  let resultText = "勝者判定: 未決定";
  if (seatsA > seatsB && seatsA >= MAJORITY) {
    resultText = `勝者判定: ${nameA} が過半数を獲得！`;
  } else if (seatsB > seatsA && seatsB >= MAJORITY) {
    resultText = `勝者判定: ${nameB} が過半数を獲得！`;
  } else if (seatsA === seatsB && seatsA >= MAJORITY) {
    resultText = `勝者判定: ${nameA} と ${nameB} が同数過半数！`;
  }
  document.getElementById("result").textContent = resultText;
}

function resetSimulation() {
  document.getElementById("nameA").value = "候補A";
  document.getElementById("nameB").value = "候補B";
  document.getElementById("candidateA").innerHTML = `<h2>候補A（合計: 0）</h2><div id="listA" class="list"></div>`;
  document.getElementById("candidateB").innerHTML = `<h2>候補B（合計: 0）</h2><div id="listB" class="list"></div>`;
  document.getElementById("others").innerHTML = `<h2>その他（合計: 0）</h2><div id="listOthers" class="list"></div>`;
  initPool();
  updateCounts();
}
</script>

</body>
</html>