<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>首班指名選挙シミュレーション（ラベル最小＋フォント拡大）</title>
<style>
  body {
    font-family: sans-serif;
    background-color: #f4f4f4;
    margin: 0;
  }
  h1 {
    text-align: center;
    font-size: 1.2em;
    margin: 10px 0;
  }
  .container {
    display: flex;
    justify-content: space-around;
    margin-top: 10px;
    flex-wrap: wrap;
  }
  .candidate-area {
    width: 23%;
    margin: 5px;
    display: flex;
    flex-direction: column;
    align-items: stretch;
    background-color: #fff;
    border: 2px solid #aaa;
    box-sizing: border-box;
  }
  .candidate {
    position: relative;
    display: flex;
    flex-direction: column-reverse; /* 下から積み上げ */
    align-items: flex-start;
    height: 270px; /* バー積み上げゾーンを広げる */
    padding: 5px;
    box-sizing: border-box;
    background-color: #fff;
    overflow-y: auto;
  }
  .party {
    margin: 2px 0;
    cursor: grab;
    border-radius: 5px;
    text-align: center;
    font-weight: bold;
    color: #fff;
    font-size: 0.8em;
    padding: 3px;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
  }
  .majority-marker {
    position: absolute;
    top: 40px;
    left: 0;
    width: 100%;
    border-top: 2px dashed red;
    text-align: center;
    font-size: 0.7em;
    color: red;
    background-color: rgba(255,255,255,0.7);
    pointer-events: none;
  }
  /* ラベルエリア最小化＋フォント拡大 */
  .bottom-info {
    width: 100%;
    font-size: 1em; /* 大きくする */
    font-weight: bold;
    text-align: left;
    background: #f9f9f9;
    padding: 3px;
    box-sizing: border-box;
    border-top: 1px solid #ccc;
    min-height: 24px; /* 必要最低限の高さ */
  }
  #pool {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    width: 23%;
    border: 2px solid #aaa;
    padding: 5px;
    box-sizing: border-box;
    background-color: #fff;
    margin: 5px;
  }
  .pool-bar {
    cursor: grab;
    border-radius: 3px;
    color: #fff;
    font-weight: bold;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
    margin: 3px 0;
    padding-left: 5px;
    white-space: nowrap;
    width: 100%;
    height: 20px;
    display: flex;
    align-items: center;
    font-size: 0.8em;
  }
  .result {
    text-align: center;
    font-size: 1em;
    margin-top: 15px;
    font-weight: bold;
  }
  .name-inputs {
    text-align: center;
    margin: 10px;
  }
  .name-inputs input {
    padding: 5px;
    margin: 5px;
    font-size: 0.9em;
    width: 100px;
  }
  @media (max-width: 768px) {
    .container {
      flex-direction: column;
      align-items: center;
    }
    .candidate-area, #pool {
      width: 95%;
    }
    .candidate {
      height: 200px;
    }
    .bottom-info {
      font-size: 1.1em;
    }
  }
</style>
</head>
<body>

<h1>衆議院 首班指名選挙 決選投票シミュレーション</h1>

<div class="name-inputs">
  候補A名: <input id="nameA" type="text" value="候補A">
  候補B名: <input id="nameB" type="text" value="候補B">
  <button onclick="updateCounts()">名前更新</button>
  <button onclick="resetSimulation()">リセット</button>
</div>

<div class="container">
  <div id="pool">
    <h2>議席プール</h2>
  </div>
  <div class="candidate-area">
    <div id="candidateA" class="candidate">
      <div class="majority-marker">過半数 233</div>
    </div>
    <div id="bottomA" class="bottom-info"></div>
  </div>
  <div class="candidate-area">
    <div id="candidateB" class="candidate">
      <div class="majority-marker">過半数 233</div>
    </div>
    <div id="bottomB" class="bottom-info"></div>
  </div>
  <div class="candidate-area">
    <div id="others" class="candidate"></div>
    <div id="bottomO" class="bottom-info"></div>
  </div>
</div>

<div id="result" class="result">勝者判定: 未決定</div>

<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>

<script>
const MAJORITY = 233;
const MAX_HEIGHT = 100;
const MIN_HEIGHT = 20;
const oppositionMembers = [
  "緒方","吉良","北神","福島","守島",
  "阿部","斉木","松原","中村","平岩","林","河村","竹上"
];
const parties = [
  { name: "自民", seats: 196, color: "#DC1E1E" },
  { name: "公明", seats: 24, color: "#FA5ABE" },
  { name: "立憲", seats: 148, color: "#0078DC" },
  { name: "維新", seats: 34, color: "#82BE1E" },
  { name: "共産", seats: 8, color: "#9600BE" },
  { name: "国民", seats: 27, color: "#2D37D7" },
  { name: "れいわ", seats: 9, color: "#DC0082" },
  { name: "社民", seats: 1, color: "#00AAF0" },
  { name: "参政", seats: 3, color: "#F06932" },
  { name: "保守", seats: 1, color: "#646EFF" },
  { name: "世耕", seats: 1, color: "#C80028" },
  ...oppositionMembers.map(name => ({ name, seats: 1, color: "#003246" }))
];

function createPoolBar(party) {
  const div = document.createElement("div");
  div.className = "pool-bar";
  div.textContent = `${party.name} (${party.seats})`;
  div.dataset.seats = party.seats;
  div.dataset.name = party.name;
  div.style.backgroundColor = party.color;
  return div;
}

function createPartyElement(party) {
  const div = document.createElement("div");
  div.className = "party";
  div.textContent = `${party.name} (${party.seats})`;
  div.dataset.seats = party.seats;
  div.dataset.name = party.name;
  div.style.backgroundColor = party.color;
  const maxWidth = 100;
  const minWidth = 40;
  const widthPercent = Math.max((party.seats / MAJORITY) * 100, minWidth);
  div.style.width = `${Math.min(widthPercent, maxWidth)}%`;
  const heightPx = Math.max((party.seats / MAJORITY) * MAX_HEIGHT, MIN_HEIGHT);
  div.style.height = `${heightPx}px`;
  return div;
}

function initPool() {
  const pool = document.getElementById("pool");
  pool.innerHTML = "<h2>議席プール</h2>";
  parties.forEach(p => pool.appendChild(createPoolBar(p)));
}
initPool();

['pool','candidateA','candidateB','others'].forEach(id => {
  new Sortable(document.getElementById(id), {
    group: 'shared',
    animation: 150,
    sort: false,
    onAdd: function(evt) {
      if (evt.to.classList.contains('candidate')) {
        const el = evt.item;
        const partyObj = { 
          name: el.dataset.name, 
          seats: parseInt(el.dataset.seats), 
          color: el.style.backgroundColor 
        };
        const newBar = createPartyElement(partyObj);
        el.replaceWith(newBar);
      }
      updateCounts();
    }
  });
});

function updateCounts() {
  const nameA = document.getElementById("nameA").value || "候補A";
  const nameB = document.getElementById("nameB").value || "候補B";
  const partiesA = Array.from(document.getElementById("candidateA").querySelectorAll(".party"));
  const partiesB = Array.from(document.getElementById("candidateB").querySelectorAll(".party"));
  const partiesO = Array.from(document.getElementById("others").querySelectorAll(".party"));

  const seatsA = partiesA.reduce((sum, el) => sum + parseInt(el.dataset.seats), 0);
  const seatsB = partiesB.reduce((sum, el) => sum + parseInt(el.dataset.seats), 0);
  const seatsO = partiesO.reduce((sum, el) => sum + parseInt(el.dataset.seats), 0);

  document.getElementById("bottomA").textContent = `${nameA}（合計: ${seatsA}）` + 
    (partiesA.length ? "：" + partiesA.map(el => `${el.dataset.name} (${el.dataset.seats})`).join("、") : "");
  document.getElementById("bottomB").textContent = `${nameB}（合計: ${seatsB}）` + 
    (partiesB.length ? "：" + partiesB.map(el => `${el.dataset.name} (${el.dataset.seats})`).join("、") : "");
  document.getElementById("bottomO").textContent = `その他（合計: ${seatsO}）` + 
    (partiesO.length ? "：" + partiesO.map(el => `${el.dataset.name} (${el.dataset.seats})`).join("、") : "");

  let resultText = "勝者判定: 未決定";
  if (seatsA > seatsB && seatsA >= MAJORITY) resultText = `勝者判定: ${nameA} が過半数を獲得！`;
  else if (seatsB > seatsA && seatsB >= MAJORITY) resultText = `勝者判定: ${nameB} が過半数を獲得！`;
  else if (seatsA === seatsB && seatsA >= MAJORITY) resultText = `勝者判定: ${nameA} と ${nameB} が同数過半数！`;

  document.getElementById("result").textContent = resultText;
}

function resetSimulation() {
  document.getElementById("nameA").value = "候補A";
  document.getElementById("nameB").value = "候補B";
  document.getElementById("candidateA").innerHTML = `<div class="majority-marker">過半数 233</div>`;
  document.getElementById("candidateB").innerHTML = `<div class="majority-marker">過半数 233</div>`;
  document.getElementById("others").innerHTML = ``;
  document.getElementById("bottomA").textContent = `候補A（合計: 0）`;
  document.getElementById("bottomB").textContent = `候補B（合計: 0）`;
  document.getElementById("bottomO").textContent = `その他（合計: 0）`;
  initPool();
  updateCounts();
}
</script>

</body>
</html>